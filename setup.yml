--- 
- 
  become: true
  hosts: default
  remote_user: vagrant
  tasks: 

    # Step 1: install the CDH 5 "1-click Install" package:
    - name: "Step 1 - Install CDH5 1-click Install"
      apt: 
        deb: "http://archive.cloudera.com/cdh5/one-click-install/precise/amd64/cdh5-repository_1.0_all.deb"

    # Step 2: add a repository key. This key enables you to verify that you are downloading genuine packages.
    - name: "Step 2 - Add a Repository Key"
      apt_key: 
        url: "https://archive.cloudera.com/cdh5/ubuntu/precise/amd64/cdh/archive.key"
    
    - name: Install hadoop and update repo cache
      apt: 
        name: hadoop-0.20-conf-pseudo
        update_cache: yes

    - name: Install Java jdk
      apt: 
        name: openjdk-7-jdk


    - name: Verify Hadoop
      command: dpkg -L hadoop-0.20-conf-pseudo

    - name: Format NodeName
      command: hdfs namenode -format

    - name: Start HDFS
      shell: 'for x in `cd /etc/init.d ; ls hadoop-hdfs-*` ; do sudo service $x start ; done'
